<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Echoes of Impact</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to bottom, #0d1117, #111827);
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

header {
  text-align: center;
  padding: 20px;
  background: #111827;
  width: 100%;
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

header h1 {
  margin: 0;
  font-size: 2em;
  color: #14b8a6;
}

header p {
  margin: 5px 0 0 0;
  color: #cbd5e1;
}

main {
  display: flex;
  width: 90%;
  max-width: 1200px;
  gap: 20px;
  margin-top: 20px;
}

#map {
  flex: 2;
  height: 600px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

#sidebar {
  flex: 1;
  background: #1f2937;
  padding: 15px;
  border-radius: 12px;
  overflow-y: auto;
  max-height: 600px;
}

#sidebar h2 {
  color: #14b8a6;
  margin-top: 0;
}

#formContainer {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
  width: 90%;
  max-width: 1200px;
}

input, select, textarea {
  padding: 8px;
  border-radius: 8px;
  border: none;
  width: 100%;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
}

button {
  padding: 8px 15px;
  border-radius: 8px;
  border: none;
  background-color: #0f766e;
  color: #fff;
  cursor: pointer;
}

button:hover {
  background-color: #14b8a6;
}

.comment {
  background: #111827;
  padding: 5px 8px;
  margin: 5px 0;
  border-radius: 6px;
}

.quote {
  font-style: italic;
  color: #facc15;
  margin-top: 3px;
}
</style>
</head>
<body>

<header>
  <h1>Echoes of Impact</h1>
  <p>See kindness ripple across the world üåç</p>
</header>

<main>
  <div id="map"></div>

  <div id="sidebar">
    <h2>All Deeds</h2>
    <div id="deedsList"></div>
  </div>
</main>

<div id="formContainer">
  <input type="text" id="deedInput" placeholder="Describe your good deed">
  <select id="category">
    <option value="Environment" data-color="#16a34a">Environment üå±</option>
    <option value="Community" data-color="#3b82f6">Community ü§ù</option>
    <option value="Health" data-color="#ef4444">Health ‚ù§Ô∏è</option>
    <option value="Education" data-color="#facc15">Education üìò</option>
  </select>
  <button onclick="addDeed()">Add Ripple</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Initialize Map
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Store deeds
let deeds = [];

// Predefined inspirational quotes
const quotes = [
  "Kindness is contagious. Pass it on.",
  "A single act of kindness throws out roots in all directions.",
  "No act of kindness, no matter how small, is ever wasted.",
  "Happiness doesn‚Äôt result from what we get, but from what we give.",
  "One small positive thought can change your whole day.",
  "Be the reason someone believes in the goodness of people."
];

// Add deed
function addDeed() {
  const deedText = document.getElementById('deedInput').value.trim();
  if (!deedText) return alert("Please enter a deed!");

  const categorySelect = document.getElementById('category');
  const category = categorySelect.value;
  const color = categorySelect.options[categorySelect.selectedIndex].dataset.color;

  const quote = quotes[Math.floor(Math.random() * quotes.length)];

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      createRipple(lat, lon, deedText, category, color, quote);
    }, () => fallbackDeed(deedText, category, color, quote));
  } else {
    fallbackDeed(deedText, category, color, quote);
  }

  document.getElementById('deedInput').value = '';
}

function fallbackDeed(deedText, category, color, quote) {
  const lat = (Math.random() * 140) - 70;
  const lon = (Math.random() * 360) - 180;
  createRipple(lat, lon, deedText, category, color, quote);
}

function createRipple(lat, lon, deedText, category, color, quote) {
  // Base permanent circle
  const baseCircle = L.circle([lat, lon], {
    color: color,
    fillColor: color,
    fillOpacity: 0.3,
    radius: 50000
  }).addTo(map);

  // Animated ripple
  let ripple = L.circle([lat, lon], {
    color: color,
    fillColor: color,
    fillOpacity: 0.5,
    radius: 50000
  }).addTo(map);

  let radius = 50000;
  const interval = setInterval(() => {
    radius += 15000;
    ripple.setRadius(radius);
    ripple.setStyle({fillOpacity: Math.max(0.5 - (radius / 500000), 0)});
    if(radius > 300000){
      map.removeLayer(ripple);
      clearInterval(interval);
    }
  }, 200);

  // Add to deeds array
  const deedObj = {lat, lon, text: deedText, category, color, quote, comments: []};
  deeds.push(deedObj);
  updateSidebar(deedObj, baseCircle);
}

function updateSidebar(deed, circle) {
  const deedsList = document.getElementById('deedsList');
  const deedDiv = document.createElement('div');
  deedDiv.style.borderBottom = "1px solid #333";
  deedDiv.style.padding = "5px 0";

  deedDiv.innerHTML = `
    <b style="color:${deed.color}">${deed.category}</b>: ${deed.text}
    <div class="quote">"${deed.quote}"</div>
    <div style="margin-top:5px;">
      <input type="text" placeholder="Add comment" style="padding:4px;width:70%;" id="commentInput${deeds.length}">
      <button onclick="addComment(${deeds.length-1}, 'commentInput${deeds.length}')">Comment</button>
    </div>
    <div id="commentList${deeds.length}" style="margin-top:5px;"></div>
  `;

  deedsList.prepend(deedDiv);

  deedDiv.onclick = () => {
    map.setView([deed.lat, deed.lon], 5);
    circle.openPopup();
  };
}

function addComment(index, inputId) {
  const input = document.getElementById(inputId);
  const commentText = input.value.trim();
  if (!commentText) return;
  deeds[index].comments.push(commentText);

  const commentList = document.getElementById(`commentList${index+1}`);
  const commentDiv = document.createElement('div');
  commentDiv.className = "comment";
  commentDiv.textContent = commentText;
  commentList.appendChild(commentDiv);

  input.value = '';
}
</script>
</body>
</html>
